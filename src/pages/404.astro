---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Navbar from '@/components/layout/Navbar.astro';
import { getCollection } from 'astro:content';

// Recupera gli ultimi 3 articoli per suggerimenti
const posts = await getCollection('blog', ({ data }) => !data.draft);
const recentPosts = posts
  .sort((a, b) => new Date(b.data.publishedAt).getTime() - new Date(a.data.publishedAt).getTime())
  .slice(0, 3);

const title = 'Pagina non trovata';
const description = 'La pagina che stai cercando non esiste o e stata spostata.';
---

<BaseLayout
  title={title}
  description={description}
  robots={{ index: false, follow: true }}
>
  <div class="w-full max-w-[1600px] mx-auto p-4 md:p-6">
    <div class="bg-surface-container-low rounded-[40px] px-6 pt-2 pb-16 relative overflow-hidden elevation-0">
      <Navbar />

      <div class="mt-16 md:mt-24 max-w-3xl mx-auto text-center relative z-10">
        <!-- Error Code -->
        <div class="text-[120px] md:text-[180px] font-bold text-primary/10 leading-none select-none">
          404
        </div>

        <!-- Message -->
        <h1 class="text-display-small md:text-display-medium font-bold text-on-surface -mt-8 md:-mt-12 mb-4">
          Pagina non trovata
        </h1>
        <p class="text-body-large text-on-surface-variant mb-8 max-w-lg mx-auto">
          La pagina che stai cercando potrebbe essere stata rimossa, rinominata, o non e mai esistita.
        </p>

        <!-- Actions -->
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-16">
          <a
            href="/"
            class="inline-flex items-center gap-2 px-6 py-3 rounded-full bg-primary text-on-primary text-label-large font-medium hover:bg-primary/90 transition-colors elevation-1 hover:elevation-2"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
              <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            Torna alla Home
          </a>
          <a
            href="/blog/"
            class="inline-flex items-center gap-2 px-6 py-3 rounded-full border-2 border-primary text-primary text-label-large font-medium hover:bg-primary hover:text-on-primary transition-colors"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/>
            </svg>
            Vai al Blog
          </a>
        </div>

        <!-- Suggested Articles -->
        {recentPosts.length > 0 && (
          <div class="text-left">
            <h2 class="text-title-large font-bold text-on-surface mb-6 text-center">
              Articoli Recenti
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              {recentPosts.map((post) => (
                <a
                  href={`/blog/${post.slug}/`}
                  class="p-4 rounded-2xl bg-surface-container hover:bg-surface-container-high transition-colors group"
                >
                  <h3 class="text-title-medium font-medium text-on-surface group-hover:text-primary transition-colors line-clamp-2 mb-2">
                    {post.data.title}
                  </h3>
                  <p class="text-body-small text-on-surface-variant line-clamp-2">
                    {post.data.summary}
                  </p>
                </a>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  </div>
</BaseLayout>
